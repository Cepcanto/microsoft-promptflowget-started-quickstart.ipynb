$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
environment:
  python_requirements_txt: requirements.txt
inputs:
  text_chunk:
    type: string
    is_chat_input: false
outputs:
  question:
    type: string
    reference: ${validate_test_question.output}
  ground_truth:
    type: string
    reference: ${validate_ground_truth.output}
  debug_info:
    type: string
    reference: ${generate_debug_info.output}
nodes:
- name: validate_text_trunk_prompt
  type: prompt
  source:
    type: code
    path: validate_text_trunk_prompt.jinja2
  inputs:
    context: ${inputs.text_chunk}
  use_variants: false
- name: validate_seed_question_prompt
  type: prompt
  source:
    type: code
    path: validate_question_prompt.jinja2
  inputs:
    question: ${validate_and_generate_seed_question.output}
  use_variants: false
- name: seed_question_prompt
  type: prompt
  source:
    type: code
    path: seed_question_prompt.jinja2
  inputs:
    context: ${inputs.text_chunk}
  use_variants: false
- name: generate_ground_truth_prompt
  type: prompt
  source:
    type: code
    path: generate_ground_truth_prompt.jinja2
  inputs:
    context: ${inputs.text_chunk}
    question: ${validate_test_question.output}
  use_variants: false
- name: validate_and_generate_seed_question
  type: python
  source:
    type: code
    path: validate_and_generate_seed_question.py
  inputs:
    connection:
    model: gpt-4
    validate_text_trunk_prompt: ${validate_text_trunk_prompt.output}
    seed_question_prompt: ${seed_question_prompt.output}
    context: ${inputs.text_chunk}
  use_variants: false
- name: validate_and_generate_test_question
  type: python
  source:
    type: code
    path: validate_and_generate_test_question.py
  inputs:
    connection:
    model: gpt-4
    validate_seed_question_prompt: ${validate_seed_question_prompt.output}
    seed_question: ${validate_and_generate_seed_question.output}
  use_variants: false
- name: validate_question_prompt
  type: prompt
  source:
    type: code
    path: validate_question_prompt.jinja2
  inputs:
    question: ${validate_and_generate_test_question.output.question}
  use_variants: false
- name: validate_test_question
  type: python
  source:
    type: code
    path: validate_test_question.py
  inputs:
    connection:
    model: gpt-4
    question_info: ${validate_and_generate_test_question.output}
    validate_question_prompt: ${validate_question_prompt.output}
  use_variants: false
- name: generate_ground_truth
  type: python
  source:
    type: code
    path: generate_ground_truth.py
  inputs:
    connection:
    context: ${inputs.text_chunk}
    generate_ground_truth_prompt: ${generate_ground_truth_prompt.output}
    model: gpt-4
    question: ${validate_test_question.output}
  use_variants: false
- name: generate_debug_info
  type: python
  source:
    type: code
    path: generate_debug_info.py
  inputs:
    question_type: ${validate_and_generate_test_question.output.question_type}
    text_trunk: ${inputs.text_chunk}
- name: validate_ground_truth_prompt
  type: prompt
  source:
    type: code
    path: validate_ground_truth_prompt.jinja2
  inputs:
    ground_truth: ${generate_ground_truth.output}
- name: validate_ground_truth
  type: python
  source:
    type: code
    path: validate_ground_truth.py
  inputs:
    connection:
    model: gpt-4
    ground_truth: ${generate_ground_truth.output}
    validate_ground_truth_prompt: ${validate_ground_truth_prompt.output}
