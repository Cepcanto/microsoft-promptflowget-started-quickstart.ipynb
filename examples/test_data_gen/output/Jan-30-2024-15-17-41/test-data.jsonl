{"question": "What is the purpose of custom HTTP headers in AzureOpenAI API calls?", "suggested_answer": "The purpose of custom HTTP headers in AzureOpenAI API calls is for usage tracking by the AzureOpenAI team. These headers facilitate detailed breakdown of usage scenarios such as authoring/test/evaluation runs, batch inference, and real-time inference. They also allow for logging PromptFlow-specific information such as run mode, subscription id, resource group, workspace name, and other metadata related to Azure Machine Learning (AML) workspaces and the PromptFlow usage. Additionally, a custom header like x-ms-useragent is chosen to overcome platform limitations that prevent modifying the default User-Agent header.", "debug_info": {"question_type": "simple", "text_trunk": "Purpose\n\nWe need to be able to set proper HTTP headers when calling AzureOpenAI APIs to make it possible for AzureOpenAI team for usage tracking.\n\n\n\nGoal\n\nFollow the guidelines from AzureOpenAI team  on HTTP header definitions.\n\nShould be able to break down detailed PromptFlow usage scenarios, i.e.:\n\nAuthoring/test/evaluation runs\n\nBatch inference (prompt flow converted to component running in a pipeline)\n\nReal-time inference (prompt flow deployed as online endpoint)\n\nHow are the AzureOpenAI APIs called\n\nThe Azure OpenAI APIs are called by the OpenAI Python SDK. See here  for details.\n\n\n\nOpenAI Python SDK will set some default headers when calling Azure OpenAI APIs. In addition, it also allows the callers (PromptFlow sdk for this case) define some custom HTTP headers.\n\n\n\nThe call path looks like:\n\n\n\nPromptFlow SDK --(call with custom headers)--> OpenAI Python SDK --(call with custom headers + OpenAI populated headers)--> Azure OpenAI API\n\n\n\nWhat custom headers to add\n\nx-ms-useragent\n\nThe value should look like promptflow-runtime/{version} promptflow-sdk/{version}.\n\n\n\nThe promptflow-sdk part is a fixed value, which indicates that the request was from PromptFlow.\n\nThe {version} part is PromptFlow defined value. It might be either a semver like 0.0.1 or a git commit hash. This field is for PromptFlow internal usage only and the format might change in the future.\n\nAs mentioned above, we call Azure OpenAI's endpoint via the OpenAI's python library, which is not owned by our team. We chose x-ms-useragent rather than the default User-Agent due to \"This header is used when the platform does not support changing the User-Agent (i.e. in a browser).\"\n\n\n\nms-azure-ai-promptflow\n\nThis is a customized header for PromptFlow.\n\n\n\nAccording to the design doc , all the headers that start from ms-azure-ai- will be logged. We chose this field to log some PromptFlow-specific information.\n\n\n\nHeader\tExplanation\tValue\n\nms-azure-ai-promptflow-run-mode\tpromptflow run mode\tFlow, SingleNode, FromNode, BulkTest, Eval\n\nms-azure-ai-promptflow-called-from\tAOAI call source\taoai-tool - call from built-in aoai tool\n\nms-azure-ai-promptflow-subscription-id\tAML workspace subscription id\t96aede12-2f73-41cb-b983-6d11a904839b\n\nms-azure-ai-promptflow-resource-group\tAML workspace resource group\tpromptflow\n\nms-azure-ai-promptflow-workspace-name\tAML workspace name\tpromptflow-canary-dev\n\nms-azure-ai-promptflow-workspace-id\tAML workspace id\t\n\nms-azure-ai-promptflow-edition\tpromptflow runtime edition\tenterprise, community\n\nms-azure-ai-promptflow-compute-type\tpromptflow runtime compute type\tmanaged_online_deployment, compute_instance, local\n\nms-azure-ai-promptflow-runtime-mode\tpromptflow runtime mode\tcompute - authoring run, serving - scoring run\n\nms-azure-ai-promptflow-flow-id\trun flow id\tb6736c3d-5446-4b21-9fd1-c7f1246e67c3\n\nms-azure-ai-promptflow-root-run-id\troot run id\t63ea2263-90ab-4473-b9dc-0e47a55eef73\n\nms-azure-ai-promptflow-index\tindex\t0\n\nms-azure-ai-promptflow-run-id\trun id\t63ea2263-90ab-4473-b9dc-0e47a55eef73_0\n\nms-azure-ai-promptflow-variant-id\tvariant id\tvariant_0\n\nReferences\n\n\"HTTP Headers for Telemetry\" from Cognitive Services wiki page \n\nThe design doc listed in the wiki page", "text_meta": "{}", "generation_summary": {"success": true, "failed_step": "", "failed_reason": ""}, "generation_details": {"text_trunk": {"pass_validation": true, "reason_if_failed": null}, "seed_question": {"generated_question": "What is the purpose of custom HTTP headers in AzureOpenAI API calls?", "pass_validation": true, "reason_if_failed": null}, "suggested_answer": {"generated_suggested_answer": "The purpose of custom HTTP headers in AzureOpenAI API calls is for usage tracking by the AzureOpenAI team. These headers facilitate detailed breakdown of usage scenarios such as authoring/test/evaluation runs, batch inference, and real-time inference. They also allow for logging PromptFlow-specific information such as run mode, subscription id, resource group, workspace name, and other metadata related to Azure Machine Learning (AML) workspaces and the PromptFlow usage. Additionally, a custom header like x-ms-useragent is chosen to overcome platform limitations that prevent modifying the default User-Agent header.", "pass_validation": true, "reason_if_failed": null}}}}
