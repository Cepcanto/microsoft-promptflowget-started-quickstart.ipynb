- name: {{ step_name }}
  working-directory: ${{ '{{' }} github.workspace }}
  run: |
    python scripts/readme/extract_steps_from_readme.py -f {{ readme_name }} -o {{ working_dir }}
- name: Cat script
  working-directory: {{ working_dir }}
  run: |
    cat bash_script.sh
- name: Run scripts against canary workspace (scheduled runs only)
  uses: azure/powershell@v1
  if: github.event_name == 'schedule'
  with:
    azPSVersion: "latest"
    inlineScript: |
      cd $Env:GITHUB_WORKSPACE/{{ working_dir }}
      $Env:aoai_api_key=${{ '{{' }}secrets.AOAI_GPT_4V_KEY }}
      $Env:aoai_api_endpoint=${{ '{{' }} secrets.AOAI_GPT_4V_ENDPOINT }}
      $Env:test_workspace_sub_id=${{ '{{' }} secrets.TEST_WORKSPACE_SUB_ID }}
      $Env:test_workspace_rg=${{ '{{' }} secrets.TEST_WORKSPACE_RG }}
      $Env:test_workspace_name=${{ '{{' }} secrets.TEST_WORKSPACE_NAME_CANARY }}
      bash bash_script.sh
- name: Run scripts against production workspace
  uses: azure/powershell@v1
  if: github.event_name != 'schedule'
  with:
    azPSVersion: "latest"
    inlineScript: |
      cd $Env:GITHUB_WORKSPACE/{{ working_dir }}
      $Env:aoai_api_key=${{ '{{' }}secrets.AOAI_GPT_4V_KEY }}
      $Env:aoai_api_endpoint=${{ '{{' }} secrets.AOAI_GPT_4V_ENDPOINT }}
      $Env:test_workspace_sub_id=${{ '{{' }} secrets.TEST_WORKSPACE_SUB_ID }}
      $Env:test_workspace_rg=${{ '{{' }} secrets.TEST_WORKSPACE_RG }}
      $Env:test_workspace_name=${{ '{{' }} secrets.TEST_WORKSPACE_NAME_PROD }}
      bash bash_script.sh
- name: Pip List for Debug
  if : ${{ '{{' }} always() }}
  working-directory: {{ working_dir }}
  run: |
    pip list
- name: Upload artifact
  if: ${{ '{{' }} always() }}
  uses: actions/upload-artifact@v4
  with:
    name: artifact
    path: {{ working_dir }}/bash_script.sh